<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <link href="/static/design/style.css" rel="stylesheet" type="text/css"/>
  <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" rel="stylesheet"/>
  <title>
   test
  </title>
 </head>
 <body>
  <!-- Navbar Section -->
  <nav class="navbar">
   <div class="navbar__container">
    <a href="/my_table_of_period" id="navbar__logo">
     <img src="/static//pictures/logo.png" style="width: 200px;"/>
    </a>
    <div class="navbar__toggle" id="mobile-menu">
     <span class="bar">
     </span>
     <span class="bar">
     </span>
     <span class="bar">
     </span>
    </div>
    <ul class="navbar__menu">
     <li class="navbar__item">
      <a class="navbar__links" href="/my_table_of_period" id="home-page">
       Dashbord
      </a>
     </li>
     <!-- <li class="navbar__item">
              <a href="#about" class="navbar__links" id="about-page">About</a>
            </li> -->
     <li class="navbar__item">
      <a class="navbar__links" href="/dashbord" id="services-page">
       My workspace
      </a>
     </li>
     <!-- <li class="navbar__btn">
              <a href="#sign-up" class="button" id="signup">Contactez nous</a>
            </li> -->
    </ul>
   </div>
  </nav>
  <div class="show_report_graphe">
   <div class="reports_name_parent">
    <img onclick="location='/dashbord/d72eff1f-51d2-4e98-b093-fddce847145d'" src="/static/pictures/back.svg" style="width: 30px; height:30px;"/>
    <div class="report_name_child" id="report_listen">
     <img class="pbi_report_icon" src="/static/pictures/pbi_icon.png"/>
     <label class="name_report" for="d72eff1f-51d2-4e98-b093-fddce847145d/e9fde765-f95d-424a-b879-f2f0a89c171f">
      dta_addd3.pbix
     </label>
    </div>
    <div class="his_function">
     <div class="share_report">
      <img alt="share_icon" id="imgg" src="/static/pictures/share.svg"/>
     </div>
     <div class="download_report">
     </div>
    </div>
   </div>
   <br/>
   <div class="report_graph" id="report_frame_for_screen">
    <iframe allowfullscreen="true" class="graphe_of_embded_report" frameborder="0" src="https://app.powerbi.com/reportEmbed?reportId=e9fde765-f95d-424a-b879-f2f0a89c171f&amp;groupId=d72eff1f-51d2-4e98-b093-fddce847145d&amp;w=2&amp;config=eyJjbHVzdGVyVXJsIjoiaHR0cHM6Ly9XQUJJLVVTLUNFTlRSQUwtQi1QUklNQVJZLXJlZGlyZWN0LmFuYWx5c2lzLndpbmRvd3MubmV0IiwiZW1iZWRGZWF0dXJlcyI6eyJtb2Rlcm5FbWJlZCI6dHJ1ZSwiYW5ndWxhck9ubHlSZXBvcnRFbWJlZCI6dHJ1ZSwiY2VydGlmaWVkVGVsZW1ldHJ5RW1iZWQiOnRydWUsInVzYWdlTWV0cmljc1ZOZXh0Ijp0cnVlLCJza2lwWm9uZVBhdGNoIjp0cnVlfX0%3d&amp;autoAuth=true&amp;ctid=a23b80fb-03cf-48e7-b7ea-4a9094cff16c" titre="dta_addd3">
    </iframe>
   </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js">
  </script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js">
  </script>
  <script data-main="scripts/app" src="scripts/require.js">
  </script>
  <script>
   //   var doc = new jsPDF();
    //     var specialElementHandlers = {
    //         '#editor': function (element, renderer) {
    //             return true;
    //         }
    //     };

    //     $('#imgg').click(function () {
    //         doc.fromHTML($('.report_graph').html(), 15, 15, {
    //             'width': 768,
    //                 'elementHandlers': specialElementHandlers
    //         });
    //         doc.save('sample-file.pdf');
    //     });
    
    // var hiddenElement = document.createElement('a');
    // hiddenElement.href = 'data:attachment/text,' + encodeURI(document.documentElement.outerHTML);
    // hiddenElement.target = '_blank';
    // hiddenElement.download = 'myFile.txt';
    // hiddenElement.click();

    // function downloadURI(uri, name) {
    //   var link = document.createElement("a");
    //   link.download = name;
    //   link.href = uri;
    //   document.body.appendChild(link);
    //   link.click();
    //   document.body.removeChild(link);
    //   delete link;
    // }
    // // "data:text/html,HelloWorld!"
    // const r=document.querySelector('iframe').src
    // downloadURI(`data:text/html,${r}`, "helloWorld.txt");

    // i will nneeed u later
    var documentWidth = parent.window.innerWidth;
    var documentHeight = parent.window.innerHeight;
    var iframeWidth = window.innerWidth;
    var iframeHeight = window.innerHeight;
    // Get Left Position
    var iframeX = window.parent.document.querySelector('.graphe_of_embded_report').offsetLeft;
    // Get Top Position
    var iframeY = window.parent.document.querySelector('.graphe_of_embded_report').offsetTop;
    console.log(`/dashbord/${document.querySelector('label').htmlFor}`)

    const r=document.querySelector('iframe')
    const d=r.ownerDocument;
    console.log(d);

    var hiddenElement = document.createElement('a');
    hiddenElement.href = 'data:attachment/text,' + encodeURI(document.documentElement.outerHTML);
    hiddenElement.target = '_blank';
    hiddenElement.download = 'myFile.html';
    hiddenElement.click();
    
    document.getElementById('imgg').addEventListener("click", e => {
        fetch(`/dashbord/${document.querySelector('label').htmlFor}`, {
            method: "POST",
            headers: {
              "Accept": "application/json",
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              c_check: String(`${iframeX},${iframeY},${iframeWidth},${iframeHeight}`)
            })
          })
          .then(res => {
            console.log('am here')
            if (!res.ok) {
              throw Error(res.status);
            }

            return res.json();
          })
          .then(({data: {val}}) => {
            alert(val);
            window.location.href = "/send_mail"
          }).catch(err => console.error(err));
      });
  </script>
  <script crossorigin="anonymous" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js">
  </script>
 </body>
</html>