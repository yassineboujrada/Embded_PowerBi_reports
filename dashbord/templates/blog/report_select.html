{% extends "blog/base.html" %}
{% block content %}
{% load static %}
<main role="main" class="main-content">
    <legend class="border-bottom mb-4">Select Reports To Share</legend>
    <div id="form_content">
        <!-- <form method='' action=''> -->
            <!-- {% csrf_token %} -->
            <br>
            <div class="select_dash">
                <div class="form-row" style=" width: 24%; height: 70vh;">
                    <ul class="navbar-nav flex-fill w-100 mb-2">
        
                        <li class="nav-item dropdown">
                            {% for i,j in all_report %}
                            <a href="#{{i}}" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle nav-link">
                                <i class="fe fe-user fe-16"></i>
                                <span class="ml-3 item-text">{{i}}</span>
                            </a>
                          
                        
                          <ul class="collapse list-unstyled pl-4 w-100 w-100" id="{{i}}">
                            {% for k in j.value %}
                                <li class="nav-item">
                                    <a class="nav-link pl-3" onclick="show_id_information_of_place_clicked()">
                                        <span class="ml-1 item-text" id="{{k}}">{{k.name}}</span>
                                    </a>
                                </li>
                            {% endfor %}
                          </ul>
                          {% endfor %}
                        </li>
                    </ul>
                </div>
                <div style=" width: 65%; height: 70vh;">
                    <div class="form-row" style=" width: 100%; height: 60vh; display: flex; justify-content: center; align-items: center;">
                        <iframe src="" frameborder="0" style="width: 100%; height: 90%;"></iframe>
                        <!-- <p id="kk"></p> -->
                    </div>
                    <br>
                    <div style="display: flex; align-items:center; justify-content:space-evenly;">
                        <a class="btn btn-danger" style="color :#fff;" href="{% url 'dashbord-playlist' %}" id="cancel">Cancel</a>
                        <button type="submit" id="btn_sub" class="btn btn-primary">Next -></button>
                    </div>
                </div>
            </div>
        <!-- </form> -->
    </div>

</main>

<style>
    .select_dash{
        display: flex;
        justify-content: space-evenly;
        align-items: center;
    }

    #form_content{
        height: 76vh;
    }
</style>

<script>

   function show_id_information_of_place_clicked(){

        document.addEventListener('click', function xyz(e){
            e.preventDefault();
            var target = e.target || event.srcElement;
            var attributes = Array.prototype.slice.call(target.attributes).map(function(i) {
              return String(i.value)
            })
            var my_src=String(attributes).split(',')
            if(String(my_src[0])==="ml-1 item-text"){
                var url_web=String(my_src[4]).split("webUrl': '")[1].split("'")[0]
                var name_report=my_src[3].split("name': '")[1].split("'")[0]
                document.querySelector('iframe').src=String(my_src[5]).split("embedUrl': '")[1].split("'")[0]+"&autoAuth=true&ctid=a23b80fb-03cf-48e7-b7ea-4a9094cff16c";
            }

            document.getElementById('btn_sub').addEventListener("click",e=>{
                $.ajax({
                    type : "POST", 
                    url: "{% url 'dashbord-create-report' %}",
                    data: {
                    c_check: String(url_web+","+name_report),
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    dataType: "json",
                    },
                    success: function(data){
                        if(data){
                            window.location.href="/playlist/create/"
                        }
                    },
                    failure: function() {
                        
                    }
            
                });
            });
          },true)

        }
</script>

{% endblock content %}