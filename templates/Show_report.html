{% extends "base.html" %}
{% block content %}

<div class="show_report_graphe">
    
    <div class="reports_name_parent" >
      <img src="{{url_for('static',filename='pictures/back.svg')}}" style="width: 30px; height:30px;" onclick="location='/dashbord/{{work_space}}'">
        <div class="report_name_child" id='report_listen' >
         <img src="{{url_for('static',filename='pictures/pbi_icon.png')}}" class="pbi_report_icon">
            <label class="form-check-label" class="name_report" for="{{work_space}}/{{ report_id }}">
              {{ j.name }}.pbix
            </label>
        </div>

        <div class="his_function">
            <div class="share_report">
              <img id="imgg" src="{{url_for('static',filename='pictures/share.svg')}}" alt="share_icon">
            </div>
            <div class="download_report" >
            </div>
          </div>

    </div><br>
    <div class="report_graph" id="report_frame_for_screen">
      <iframe titre="{{ j.name }}" id='report_frame22' class='graphe_of_embded_report' src='{{ j.embedUrl }}' frameborder="0" allowFullScreen="true"></iframe>
    </div>

  </div>
  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script data-main="scripts/app" src="scripts/require.js"></script>

  <script>
    // var c=document.querySelector('iframe').src;
    // console.log(c);
    // var l=[]
    // let i=0
    // window.open(c, '_blank', 'location=yes,height=570,width=520,scrollbars=yes,status=yes');

    // function test(){
    //     let g=window.open(c, '_blank', 'location=yes,height=570,width=520,scrollbars=yes,status=yes');
    //     $(g).load(
    //       function() { 	
    //         let responseText = newWindow.document.documentElement.;
    //         console.log(responseText)
    //       }
    //       )
    //     // setTimeout(g.document, 10)
        

    // }
    
    // function m(){
      
    // }

    // $(window).on("unload", function(){
    //   console.log("jjjj")
    //   l.filter(function(x){
    //     return x!=window;
    //   })
    // })
    
    // window.location.href=c

    // window.open(c)

  // document.getElementById("demo").innerHTML = text;

    

    //   var doc = new jsPDF();
    //     var specialElementHandlers = {
    //         '#editor': function (element, renderer) {
    //             return true;
    //         }
    //     };

    //     $('#imgg').click(function () {
    //         doc.fromHTML($('.report_graph').html(), 15, 15, {
    //             'width': 768,
    //                 'elementHandlers': specialElementHandlers
    //         });
    //         doc.save('sample-file.pdf');
    //     });

    // i will nneeed u later
    var documentWidth = parent.window.innerWidth;
    var documentHeight = parent.window.innerHeight;
    var iframeWidth = window.innerWidth;
    var iframeHeight = window.innerHeight;
    // Get Left Position
    var iframeX = window.parent.document.getElementById('report_frame22').offsetLeft;
    // Get Top Position
    var iframeY = window.parent.document.getElementById('report_frame22').offsetTop;
    
    // alert('X '+iframeX+' Y '+iframeY+' width '+iframeWidth+' height '+iframeHeight+' docu '+documentWidth)

       

    document.getElementById('imgg').addEventListener("click", e => {
        fetch(`/dashbord/${document.querySelector('label').htmlFor}?`, {
            method: "POST",
            headers: {
              "Accept": "application/json",
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              c_check: String(`${iframeX},${iframeY},${iframeWidth},${iframeHeight}`)
            })
          })
          .then(res => {
            if (!res.ok) {
              throw Error(res.status);
            }

            return res.json();
          })
          .then(({data: {val}}) => {
            alert(val);
            window.location.href = "/send_mail"
          }).catch(err => console.error(err));
      });
  </script>
{% endblock content %}
