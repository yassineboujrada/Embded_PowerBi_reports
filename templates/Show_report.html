{% extends "base.html" %}
{% block content %}

<div class="show_report_graphe">
    
    <div class="reports_name_parent" >
      <img src="{{url_for('static',filename='pictures/back.svg')}}" style="width: 30px; height:30px;" onclick="location='/dashbord/{{work_space}}'">
        <div class="report_name_child" id='report_listen' >
         <img src="{{url_for('static',filename='pictures/pbi_icon.png')}}" class="pbi_report_icon">
            <label class="form-check-label" class="name_report" for="{{work_space}}/{{ report_id }}">
              {{ j.name }}.pbix
            </label>
        </div>

        <div class="his_function">
            <div class="share_report">
              <img id="imgg" src="{{url_for('static',filename='pictures/share.svg')}}" alt="1">
              <!-- onclick="saveDiv('report_frame22','title')"> -->
            </div>
            <div class="download_report" >
            </div>
          </div>

    </div>

    <!-- {{ j.embedUrl }} -->
    <div class="report_graph" id="report_frame_for_screen">
      <iframe titre="{{ j.name }}" id='report_frame22' class='graphe_of_embded_report' src='{{ j.embedUrl }}' frameborder="0" allowFullScreen="true"></iframe>
    </div>

  </div>
  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

  <script>
    //   var doc = new jsPDF();
    //     var specialElementHandlers = {
    //         '#editor': function (element, renderer) {
    //             return true;
    //         }
    //     };

    //     $('#imgg').click(function () {
    //         doc.fromHTML($('.report_graph').html(), 15, 15, {
    //             'width': 768,
    //                 'elementHandlers': specialElementHandlers
    //         });
    //         doc.save('sample-file.pdf');
    //     });


    // document.getElementById('imgg').onclick=(e)=>{
    //     console.log('mmmm')
    //     const canvas = document.getElementById('report_frame11');
    //     const ctx = canvas.getContext('2d');

    //     // const image = new Image(60, 45); // Using optional size for image
    //     const image = new Image(60, 45);
    //     image.onload = drawImageActualSize; // Draw when image has loaded

    //     // Load an image of intrinsic size 300x227 in CSS pixels
    //     image.src = 'ile2 name.png';
    //     console.log(canvas)
    //     function drawImageActualSize() {
    //     // Use the intrinsic size of image in CSS pixels for the canvas element
    //     canvas.width = this.naturalWidth;
    //     canvas.height = this.naturalHeight;
        
    //     // Will draw the image as 300x227, ignoring the custom size of 60x45
    //     // given in the constructor
    //     ctx.drawImage(this, 0, 0);

    //     // To use the custom size we'll have to specify the scale parameters
    //     // using the element's width and height properties - lets draw one
    //     // on top in the corner:
    //     ctx.drawImage(this, 0, 0, this.width, this.height);
    //     }
    // };

    //     function getScreenShot(){
    //         const screenshotTarget = document.querySelector('.graphe_of_embded_report');

    //         html2canvas(screenshotTarget).then((canvas) => {
    //             const base64image = canvas.toDataURL("image/png");
    //             // window.location.href = base64image;
    //             document.querySelector('.testt').src=base64image
    //             console.log('am here')
    //         });
    //    }

    // html2canvas(document.querySelector("#report_frame_for_screen")).then(canvas => {
    //     document.body.appendChild(canvas)
    // });

    
            // html2canvas(div[0]).then(
            //     function (canvas) {
            //         console.log(canvas)
            //         document.body.appendChild(canvas);
            //     })

    // i will nneeed u later
    var documentWidth = parent.window.innerWidth;
    var documentHeight = parent.window.innerHeight;
    var iframeWidth = window.innerWidth;
    var iframeHeight = window.innerHeight;
    // Get Left Position
    var iframeX = window.parent.document.getElementById('report_frame22').offsetLeft;
    // Get Top Position
    var iframeY = window.parent.document.getElementById('report_frame22').offsetTop;
    
    // alert('X '+iframeX+' Y '+iframeY+' width '+iframeWidth+' height '+iframeHeight+' docu '+documentWidth)

       

    document.getElementById('imgg').addEventListener("click", e => {
        fetch(`/dashbord/${document.querySelector('label').htmlFor}?`, {
            method: "POST",
            headers: {
              "Accept": "application/json",
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              c_check: String(`${iframeX},${iframeY},${iframeWidth},${iframeHeight}`)
            })
          })
          .then(res => {
            if (!res.ok) {
              throw Error(res.status);
            }

            return res.json();
          })
          .then(({data: {val}}) => {
            alert(val);
            document.getElementById('imgg').setAttribute("src", "{{url_for('static',filename='pictures/send.svg')}}");
            document.getElementById('imgg').setAttribute("onclick", "location='/send_mail'");
            
          }).catch(err => console.error(err));
      });



    // i neeed to uderstand it more
    // document.getElementById('imgg').addEventListener("click",()=>{
    // //   function genPdf(){
    //     html2canvas(document.body,{
    //         onrendered: function(canvas){
    //             var imgData = canvas.toDataURL('image/png');
    //             console.log('Report Image URL: '+imgData);
    //             var doc = new jsPDF('p', 'mm', [1097, 7500]); //210mm wide and 297mm high

    //             doc.addImage(imgData, 'PNG', 1097, 7500);
    //             doc.save('sample.pdf');
    //         }
    //     });
    // })

    
    // html2canvas(document.getElementById("report_frame22")).then(
    //     function (canvas2) {
    //         var img_data2 = canvas2.toDataURL('image/png');
    //         var im_data2 = img_data2.replace('data:image/png;base64,', '');
    //         $.ajax({
    //         type: "POST",
    //         url: `/dashbord/${document.querySelector('label').htmlFor}?`,
    //         data: {
    //             "base64data": im_data2,
    //             // "filename": filename.split(".")[0]
    //             "filename": 'il2 name.png'
    //         }, success: function () {
    //             //send second image and compare
    //             console.log('uu')
    //         }
    //         });
    //     }
    // );
  </script>
{% endblock content %}
